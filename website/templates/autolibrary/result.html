<!DOCTYPE html>
<html lang="en">
  <head>
    <title>AutoLibrary</title>
    {% load static %}
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="{% static 'autolibrary/css/main.css' %}" type="text/css" media="screen, projection" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  </head>
  <body style="background-color:rgb(175, 161, 130);" onload="initiate()">
    <div id="outer-wrapper">
      <div id="inner-wrapper">
        <div id="content-wrapper">
          <div id="content">
            <ul id="nav">
              <li><a href="http://127.0.0.1:8000/autolibrary">AutoLibrary</a></li>
              <li><a href="http://127.0.0.1:8000/blog">Blog</a></li>
              <li><a target="_blank" rel="noopener noreferrer" href="https://github.com/jfan1998/AutoLibrary">Code</a></li>
              <li><a href="http://127.0.0.1:8000/contact">Contact Us</a></li>
            </ul>
            <div id="content-inner">
              <div id="selection" class="content-full">
                <nav><ul id="domain_navi"></ul></nav>
                <button>Select</button>
                <h2>Selected Document</h2>
              </div>
            </div>
          </div>
          <div id="sidebar">
            <div id="logo"> <img src="{% static 'autolibrary/images/logo.png' %}" alt="Nautica X" width="180px" height="110px"/> </div>
            <h4>Documents</h4>
            <ul id="doc_list" class="side-nav"></ul>
          </div>
        </div>
        <div id="footer">
          <ul id="footer-nav">
            <li><a href="#">AutoLibrary</a></li>
            <li><a href="#">Blog</a></li>
            <li><a href="#">Code</a></li>
            <li class="last"><a href="#">Contact Us</a></li>
          </ul>
          <p class="copyright">Copyright 2021 Yichun Ren & Jiayi Fan & Bingqi Zhou</p>
        </div>
      </div>
    </div>
  </body>
</html>
<script>
  function initiate(){ 
    // sidebar
    var data = JSON.parse("{{data|escapejs}}"); 
    if (data.length > 0) {
      var ul = document.getElementById("doc_list");
      var li = document.createElement("li");
      for (var x in data) { 
        if (data[x] != '.DS_Store') {
          var btn = document.createElement("BUTTON");
          btn.className = "btn-group";
          btn.innerHTML = data[x];
          li.appendChild(btn);
        }
      } 
      ul.appendChild(li);
      // var buttons = document.getElementById('doc_list').getElementsByTagName('button');
      // var max = buttons.length;
      // for(var i = 0; i < max; i++) {
      //     buttons[i].addEventListener('click', selection, true);
      // }
    }

    // display pdf
    var file_name = JSON.parse("{{selected_doc|escapejs}}"); 
    var pdfname = JSON.parse("{{selected_pdf|escapejs}}"); 
    var div = document.getElementById("selection");
    
    var h = document.createElement("h3");
    h.innerHTML = file_name;
    div.appendChild(h);

    var embed = document.createElement('embed');
    embed.src = "{% static 'autolibrary/documents/' %}" + pdfname;
    embed.type = "application/pdf";
    embed.width = "100%";
    embed.height = "1000px";
    div.appendChild(embed);

    // select domain
    var domains = JSON.parse("{{domains|escapejs}}");
    var navi = document.getElementById('domain_navi');
    var main_li = document.createElement('li');
    var a = document.createElement('a');
    a.id = 'domain';
    a.href = '#';
    a.innerHTML = 'Select Domain';
    main_li.appendChild(a);
    var main_ul = document.createElement('ul');

    for (var domain in domains) {
      var outer_li = document.createElement('li');
      var a = document.createElement('a');
      a.href = '#';
      a.innerHTML = domain;
      a.addEventListener('click', select_domain, true);
      outer_li.appendChild(a);
      var ul = document.createElement('ul');
      for (var subdomain in domains[domain]) {
        var inner_li = document.createElement('li');
        var a = document.createElement('a');
        a.href = '#';
        a.innerHTML = domains[domain][subdomain];
        a.addEventListener('click', select_domain, true);
        inner_li.appendChild(a);
        ul.appendChild(inner_li);
      }
      outer_li.appendChild(ul);
      main_ul.appendChild(outer_li);
    
    }
    main_li.appendChild(main_ul);
    navi.appendChild(main_li);
  } 

  function select_domain(e) {
    var selected = e.target.innerHTML;
    var display = document.getElementById('domain');
    display.innerHTML = selected;
  }

  // function selection(e) {
  //   var selected = {"file_name": e.target.innerHTML};
  //   var URL = "{% url 'get_file' %}";
  //   $.post(URL, selected, function(response){
  //       if (response === 'success'){ 
  //           alert('Start searching!'); 
  //           window.location = "http://127.0.0.1:8000/result";
  //       } else { 
  //           alert('Error! :('); 
  //       }
  //   });
  // }
</script>
